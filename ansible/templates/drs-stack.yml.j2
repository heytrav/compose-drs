version: "3.1"

{% set known_secrets = [] %}
services:
{% for service_name, spec in service_list.items() %}
  {{ {service_name: spec} | to_nice_yaml(width=50, explicit_start=False, explicit_end=False)  }}
  {% known_secrets += spec.secrets %}
{% endfor %}
  
secrets:
{% for secret in known_secrets | unqiue %}
{% if secret in docker_secrets %}
 {{ secret }}: {{ docker_secrets[secret] }}
{% endif %}
{% endfor %}
